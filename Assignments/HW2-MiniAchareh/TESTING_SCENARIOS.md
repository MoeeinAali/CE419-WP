# راهنمای تست سناریوهای مینی آچاره

این مستند نحوه تست کردن سناریوهای تعریف شده در تمرین دوم را با استفاده از APIهای سیستم توضیح می‌دهد.

**پیش‌فرض‌ها:**
*   آدرس پایه سرور: `http://localhost:8000/api`
*   برای تست‌ها می‌توانید از ابزارهایی مانند Postman یا `curl` استفاده کنید.
*   در تمام درخواست‌های نیازمند احراز هویت، هدر `Authorization` را به صورت `Session` یا `Token` (بسته به تنظیمات) ارسال کنید. در اینجا فرض بر استفاده از Session Authentication است (لاگین کردن کوکی ست می‌کند).

---

## ۱. روند ثبت‌نام و ورود (بخش ۲.۵)

### ثبت‌نام کاربر جدید
*   **کاربر:** مهمان (بدون لاگین)
*   **API:** `POST /users/`
*   **Body:**
    ```json
    {
        "username": "customer1",
        "password": "password123",
        "email": "customer1@example.com",
        "phone_number": "09123456789"
    }
    ```
*   **توضیح:** کاربر به صورت پیش‌فرض با نقش `customer` ساخته می‌شود.

### ورود به سامانه
*   **کاربر:** همه کاربران
*   **API:** `POST /login/`
*   **Body:**
    ```json
    {
        "username": "customer1",
        "password": "password123"
    }
    ```

### تغییر نقش کاربر (توسط ادمین)
برای داشتن کاربر پیمانکار یا پشتیبان، ادمین باید نقش آن‌ها را تغییر دهد.
*   **کاربر:** ادمین (Admin)
*   **API:** `POST /users/{user_id}/change_role/`
*   **Body:**
    ```json
    {
        "role": "contractor" 
    }
    ```
    *(مقادیر مجاز: `customer`, `contractor`, `support`, `admin`)*

---

## ۲. ایجاد آگهی توسط مشتری (بخش ۲.۷)

*   **کاربر:** مشتری (Customer)
*   **API:** `POST /advertisements/`
*   **Body:**
    ```json
    {
        "title": "تعمیر لوله آب",
        "description": "لوله آشپزخانه چکه می‌کند",
        "category": "lule-kashi",
        "location": "تهران، خیابان آزادی",
        "execution_time": "2025-01-01T10:00:00Z"
    }
    ```
*   **نتیجه:** آگهی با وضعیت `open` ایجاد می‌شود.

---

## ۳. درخواست اخذ کار توسط پیمانکار (بخش ۲.۸)

*   **کاربر:** پیمانکار (Contractor)
*   **API:** `POST /bids/`
*   **Body:**
    ```json
    {
        "advertisement": 1  // شناسه آگهی مورد نظر
    }
    ```

---

## ۴. انتخاب پیمانکار توسط مشتری (بخش ۲.۹)

*   **کاربر:** مشتری (Customer - صاحب آگهی)
*   **API:** `POST /advertisements/{ad_id}/assign/`
*   **Body:**
    ```json
    {
        "contractor_id": 2 // شناسه کاربر پیمانکار
    }
    ```
*   **نتیجه:** وضعیت آگهی به `assigned` تغییر می‌کند.

---

## ۵. اعلام پایان کار توسط پیمانکار (بخش ۲.۱۰)

*   **کاربر:** پیمانکار (Contractor - تخصیص داده شده به آگهی)
*   **API:** `POST /advertisements/{ad_id}/mark_done/`
*   **Body:** `{}` (خالی)
*   **نتیجه:** فیلد `contractor_done` برابر `True` می‌شود.

---

## ۶. تایید پایان کار توسط مشتری (بخش ۲.۱۱)

*   **کاربر:** مشتری (Customer - صاحب آگهی)
*   **API:** `POST /advertisements/{ad_id}/confirm_done/`
*   **Body:** `{}` (خالی)
*   **نتیجه:** وضعیت آگهی به `done` تغییر می‌کند.

---

## ۷. لغو آگهی توسط مشتری (بخش ۲.۱۲)

*   **کاربر:** مشتری (Customer - صاحب آگهی)
*   **API:** `POST /advertisements/{ad_id}/cancel/`
*   **Body:** `{}` (خالی)
*   **شرط:** آگهی نباید در وضعیت `done` باشد.
*   **نتیجه:** وضعیت آگهی به `cancelled` تغییر می‌کند.

---

## ۸. ثبت نظر و امتیاز (بخش ۲.۱۳)

*   **کاربر:** مشتری (Customer - صاحب آگهی)
*   **API:** `POST /comments/`
*   **Body:**
    ```json
    {
        "advertisement": 1,
        "contractor": 2,
        "score": 5,
        "text": "کارش عالی بود"
    }
    ```
*   **شرط:** آگهی باید در وضعیت `done` باشد.

---

## ۹. مشاهده پروفایل پیمانکار (بخش ۲.۱۴)

*   **کاربر:** همه کاربران
*   **API:** `GET /users/{contractor_id}/profile/`
*   **نتیجه:** برگرداندن اطلاعات پیمانکار شامل میانگین امتیاز، تعداد کارهای انجام شده و لیست نظرات.

---

## ۱۰. مشاهده پروفایل مشتری (بخش ۲.۱۵)

*   **کاربر:** همه کاربران
*   **API:** `GET /users/{customer_id}/profile/`
*   **نتیجه:** برگرداندن اطلاعات مشتری و لیست آگهی‌های ثبت شده توسط او.

---

## ۱۱. فیلتر و مرتب‌سازی پیمانکاران (بخش ۲.۱۶ و ۲.۱۷)

*   **کاربر:** همه کاربران
*   **API:** `GET /users/contractors/`
*   **Query Params:**
    *   `min_score=4`: حداقل امتیاز ۴
    *   `min_comments=10`: حداقل ۱۰ نظر
    *   `sort_by=score`: مرتب‌سازی بر اساس امتیاز (نزولی)
    *   `sort_by=comments`: مرتب‌سازی بر اساس تعداد نظرات (نزولی)
*   **مثال:** `GET /users/contractors/?min_score=3&sort_by=score`

---

## ۱۲. ثبت تیکت (بخش ۲.۱۸)

*   **کاربر:** مشتری یا پیمانکار
*   **API:** `POST /tickets/`
*   **Body:**
    ```json
    {
        "title": "مشکل در پرداخت",
        "message": "پولم رو ندادن"
    }
    ```

---

## ۱۳. پاسخگویی به تیکت (بخش ۲.۱۹)

*   **کاربر:** پشتیبان (Support)
*   **API:** `POST /tickets/{ticket_id}/reply/`
*   **Body:**
    ```json
    {
        "response": "پیگیری می‌شود."
    }
    ```
*   **نتیجه:** وضعیت تیکت به `closed` تغییر می‌کند و پاسخ ثبت می‌شود.

---

## ۱۴. بخش امتیازی (بخش ۳)

### ۱. فیلتر کردن نظرات یک پیمانکار بر اساس امتیاز (بخش ۳.۱)
*   **کاربر:** همه کاربران
*   **API:** `GET /comments/`
*   **Query Params:**
    *   `contractor_id=2`: شناسه پیمانکار
    *   `min_score=4`: حداقل امتیاز
*   **مثال:** `GET /comments/?contractor_id=2&min_score=4`

### ۲. سطوح دسترسی پویا (تغییر نقش) (بخش ۳.۲)
*   **کاربر:** ادمین (Admin)
*   **API:** `POST /users/{user_id}/change_role/`
*   **Body:**
    ```json
    {
        "role": "support"
    }
    ```
*   **توضیح:** این قابلیت اجازه می‌دهد نقش یک کاربر موجود تغییر کند (مثلاً از مشتری به پشتیبان).

### ۳. اعلام برنامه روزانه پیمانکار (بخش ۳.۳)
*   **کاربر:** پیمانکار (Contractor)
*   **API:** `GET /users/schedule/`
*   **Query Params:**
    *   `date=2025-01-01`: (اختیاری) فیلتر بر اساس تاریخ خاص
*   **توضیح:** لیست آگهی‌های تخصیص داده شده به پیمانکار که دارای زمان اجرا (`execution_time`) هستند را برمی‌گرداند. زمان اجرا هنگام ایجاد آگهی یا ویرایش آن تعیین می‌شود.
